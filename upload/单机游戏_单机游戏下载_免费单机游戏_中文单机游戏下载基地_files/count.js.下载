/* 
* @Author: shiweijian
* @Date:   2015-02-10 15:05:31
* @Last Modified by:   shiweijian
* @Last Modified time: 2015-02-10 15:27:08
*/
var protocolStr = document.location.protocol;  
if(protocolStr == "http")  {
	countUrl='http://www.wanyx.com/interface/visitlog2';
	giftUrl='http://www.wanyx.com/interface/gift';
}else{
	countUrl='https://www.wanyx.com/interface/visitlog2';
	giftUrl='https://www.wanyx.com/interface/gift';
}
	

function visitlog(id,type,channel){
	$.ajax({
		type: "GET",
		url: countUrl,
		data:{id:id,type:type,channel:channel},
		jsonp:"jsoncallback",
		dataType : 'jsonp',
		success: function(msg) {
			if (msg.result == "success") {
				console.log(msg.info);
			}else{
				console.log(msg.info);
			}
		}
	});
}

$(window).load(function(){
	$(".giftcode").each(function(index,element){
		  gift($(element));
  });
	$('.downloadcount').click(function(){
		var id=$(this).attr('sourceid');
		var type='download';
		var channel=$(this).attr('channel');
		visitlog(id,type,channel);
		if(channel=='buding'){
			var sourceid=$(this).attr('sourceid');
			$.ajax({
				type: "get",
				url:"http://api.gameyx.com/stat/patch",
				dataType:'jsonp',
				data:{id:sourceid}
			});
		}
	})
});

function gift(ele){
	id=ele.attr('codeid');
	field=ele.attr('filed');
	$.ajax({
				type: "get",
				url:giftUrl,
				dataType:'jsonp',
				data:{id:id,field:field},
			    success:function(msg){
					ele.parent().text(msg.result);
				}
			});

}